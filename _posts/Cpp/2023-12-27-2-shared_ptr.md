---
title:  "μ¤λ§νΈ ν¬μΈν„° / shared_ptr μ…°μ–΄λ“ ν¬μΈν„°"

categories:
  - Cpp
tags:
  - [Cpp, C++, pointer, smart pointer, shared_ptr]

toc: true
toc_sticky: true
 
date: 2023-12-27
last_modified_at: 2023-12-27
---

<br>

> π¤― μ–Έλ¦¬μ–Όμ„ ν•κΈ° μ„ν•΄ C++ κΈ°μ–µ λμ‚΄λ¦¬κΈ° ν”„λ΅μ νΈ

# std::shared_ptr

## μμ‹: std::shared_ptr λ§λ“¤κΈ°

```cpp
#include <memory>
#include "Vector.h"

int main()
{
    std::shared_ptr<Vector> vector = std::make_shared<Vector>(10.f, 30.f);

    // vector λ” μ…°μ–΄λ“ ν¬μΈν„°κ°€ λκ³ ,
    // μ°Έμ΅° μΉ΄μ΄νΈλ” 1μ΄ λμ—μ„ κ²ƒμ΄λ‹¤ - λΌκ³  μ¶”μΈ΅ κ°€λ¥!
}
```

> `make_shared` λ” C++14 λ¶€ν„° μ§€μ›λλ” κ±°κ³ , μ“Έ μ μ—†λ‹¤λ©΄  
> `std::shared_ptr<Vector> vector(new Vector(10.f, 30.f));`

- λ‘ κ°μ ν¬μΈν„°λ¥Ό μ†μ 
  - λ°μ΄ν„°(μ›μ‹ ν¬μΈν„°)λ¥Ό κ°€λ¦¬ν‚¤λ” ν¬μΈν„°
  - `μ μ–΄ λΈ”λ΅`μ„ κ°€λ¦¬ν‚¤λ” ν¬μΈν„°
    - μ°Έμ΅° μΉ΄μ΄νΈ μ„Έμ•Ό ν•λ‹κΉ~ μ°Έμ΅° μΉ΄μ΄νΈ κ°€μ§€κ³  μμ„ λ©”λ¨λ¦¬ κ³µκ°„ ν•„μ”ν•λ‹κΉ λ§λ“¤μ–΄ λ‘λ” κ²ƒ
  - λ°μ΄ν„° ptr -> λ°μ΄ν„°  
  μ μ–΄ λΈ”λ΅ ptr -> κ°•ν• μ°Έμ΅° νμ, μ•½ν• μ°Έμ΅° νμ
-  std::unique_ptrμ™€ λ‹¬λ¦¬, <b>ν¬μΈν„°λ¥Ό λ‹¤λ¥Έ μ…°μ–΄λ“ ν¬μΈν„°μ™€ κ³µμ  κ°€λ¥</b>
-  μ°Έμ΅° μΉ΄μ΄ν… κΈ°λ°
-  μ›μ‹ ν¬μΈν„°λ” μ–΄λ– ν• std::shared_ptr μ—κ²λ„ μ°Έμ΅°λμ§€ μ•μ„ λ• μ†λ©Έλ¨



## μμ‹: ν¬μΈν„° κ³µμ ν•κΈ°

```cpp
int main()
{
  std::shared_ptr<Vector> vector = std::make_shared<Vector>(10.f, 30.f);
  std::shared_ptr<Vector> copiedVector = vector;
}
```

λ‘κ°™μ€ κ²ƒμ„ κ°€λ¦¬ν‚¤κ² λκ³ ,  
λ νΌλ°μ¤ μΉ΄μ΄νΈλ„ λ‘κ°™μ•„μ§.



## μμ‹: ν¬μΈν„° μ¬μ„¤μ •ν•κΈ°

```cpp
int main()
{
  std::shared_ptr<Vector> vector = std::make_shared<Vector>(10.f, 30.f);
  std::shared_ptr<Vector> copiedVector = vector;
  vector.reset();                                     // vector = nullptr κ³Ό κ°™μ~!
}
```

λ‘λ²μ§Έ μ¤„ κΉμ§„ λ‘ λ‹¤ μ°Έμ΅° μΉ΄μ΄νΈκ°€ 2κ°€ λ¨. (κ°€λ¦¬ν‚¤λ” μ…°μ–΄λ“ ν¬μΈν„°κ°€ vector, copiedVector 2κ°λ‹κΉ)  

μ½”λ“ λκΉμ§€ λ‹¤λ‹¤λ¥΄λ©΄ μµμΆ…μ μΌλ΅ vectorλ” emptyκ°€ λκ³ ,  
copiedVector μ μ°Έμ΅° μΉ΄μ΄νΈλ” 1μ΄ λ¨.

- μ›μ‹ ν¬μΈν„°λ¥Ό ν•΄μ ν•λ‹¤
  - ν¬μΈν„° λ“¤κ³  μλ”κ±Έ λ”μ΄μƒ μ°Έμ΅°ν•μ§€ μ•κ² λ‹¤, nullptr λ΅ λ°”κΎΈκ² λ‹¤λ” κ±°κ³ ,  
  μ°Έμ΅° μΉ΄μ΄νΈ 1μ΄ μ¤„μ–΄λ“¦.
  - κ·Έλ ‡λ‹¤κ³  <b>μ›μ‹ ν¬μΈν„°μ μ†λ©Έμλ¥Ό νΈμ¶ν•μ§„ μ•μ</b>. (μ§€μ°μ§„ μ•λ”λ‹¤λ” μλ―Έ)
  - μ°Έμ΅° μΉ΄μ΄νΈκ°€ 0μ΄ λκΈ° μ „μ—λ” μ›μ‹ ν¬μΈν„°μ μ†λ©Έμλ¥Ό νΈμ¶ν•μ§„ μ•μ!!!
- nullptr λ¥Ό λ€μ…ν•λ” κ²ƒκ³Ό κ°™μ



## μμ‹: μ°Έμ΅° νμ κµ¬ν•κΈ°

```cpp
int main()
{
  std::shared_ptr<Vector> vector = std::make_shared<Vector>(10.f, 30.f);
  std::cout << "vector : " << vector.use_count() << std::endl;            // vector : 1

  std::shared_ptr<Vector> copiedVector = vector;
  std::cout << "vector : " << vector.use_count() << std::endl;            // vector : 2
  std::cout << "vector : " << copiedVector.use_count() << std::endl;      // copiedVector : 2 (λ‘κ°™μ€ ν¬μΈν„° κ°€λ¦¬ν‚¤κ³  μμΌλ‹κΉ)

  return 0;
}
```

