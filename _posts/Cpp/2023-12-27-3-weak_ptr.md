---
title:  "μ¤λ§νΈ ν¬μΈν„° / weak_ptr μ„ν¬ ν¬μΈν„°"

categories:
  - Cpp
tags:
  - [Cpp, C++, pointer, smart pointer, weak_ptr]

toc: true
toc_sticky: true
 
date: 2023-12-27
last_modified_at: 2023-12-27
---

<br>

> π¤― μ–Έλ¦¬μ–Όμ„ ν•κΈ° μ„ν•΄ C++ κΈ°μ–µ λμ‚΄λ¦¬κΈ° ν”„λ΅μ νΈ

# std::weak_ptr

## μ•½ν•(weak) μ°Έμ΅°

- μ•½ν• μ°Έμ΅°λ” μ›μ‹ ν¬μΈν„° ν•΄μ μ— μν–¥μ„ λΌμΉμ§€ μ•μ
- μ•½ν• μ°Έμ΅° μΉ΄μ΄νΈλ” μ•½ν• μ°Έμ΅°μ μλ¥Ό μ €μ¥ν•λ” λ°μ— μ‚¬μ©λ¨
- μ•½ν• μ°Έμ΅°λ΅ μ°Έμ΅°λλ” κ°μ²΄λ” `κ°•ν• μ°Έμ΅° μΉ΄μ΄νΈκ°€ 0μ΄ λ  λ• μ†λ©Έλ¨`
- μν™ μ°Έμ΅° λ¬Έμ μ ν•΄κ²°μ±…



## μμ‹: μ•½ν• ν¬μΈν„° λ§λ“¤κΈ°

μ•„λ¬΄ κ²ƒλ„ μ—†λ”λ° μ•½ν• ν¬μΈν„° λ§λ“¤ μ μ—†μ.

```cpp
int main()
{
    std::shared_ptr<Person> owner = std::make_shared<Person>("Pope");   // κ°•ν• μ°Έμ΅°

    std::weak_ptr<Person> weakOwner = owner;            // μ•½ν• μ°Έμ΅°λ” κ°•ν• μ°Έμ΅°λ΅λ¶€ν„° λ‚μ¬ μ λ°–μ— μ—†μ.
                                                        // shared_ptr λ΅λ¶€ν„° weak_ptrλ¥Ό λ§λ“λ” κ²ƒ

    return 0;
}
```



## μμ‹: μ•½ν• ν¬μΈν„°λ΅ κ³µμ  ν¬μΈν„° λ§λ“¤κΈ° : Lock()

```cpp
int main()
{
    std::shared_ptr<Person> owner = std::make_shared<Person>("Pope");

    std::weak_ptr<Person> weakOwner = owner;
    
    std::shared_ptr<Person> lockedOwner = weakOwner.Lock();             // <--- μ΄κ±°!
}
```

μ•½ν• ν¬μΈν„°λ¥Ό μ“°κ³  μ‹¶μ„ λ• κ³µμ  ν¬μΈν„°λ΅ λ°”κΏ”μ„ μ¨μ•Ό ν•¨.  
μ•½ν• ν¬μΈν„°μ— `Lock()` μ„ ν•λ©΄ κ³µμ  ν¬μΈν„°λ¥Ό λ±‰μ–΄μ¤.  
μ΄ λ• κ°•ν• μ°Έμ΅° μΉ΄μ΄νΈκ°€ ν•λ‚μ”© μ¬λΌκ°€κ² λ¨.  

> μ›μ‹ ν¬μΈν„°κ°€ μ΅΄μ¬ν•λ©΄ κ³µμ  ν¬μΈν„°λ¥Ό λ§λ“ λ‹¤.



## μμ‹2: κ³µμ  ν¬μΈν„°κ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ : expired()

```cpp
int main()
{
    std::shared_ptr<Person> owner = std::make_shared<Person>("Pope");

    std::weak_ptr<Person> weakOwner = owner;
    
    if (weakOwner.expired())                    // true : λ§λ£λμ—λ‹¤λ” λ»... μ£½μ—λ‹¤λ” λ»
    {                                           // false : μ‚΄μ•„μλ‹¤λ” λ». ν¬μΈν„° μ¨λ„ λ¨
        // ...
    }
}
```

> ν•μ§€λ§ λ©€ν‹° μ“°λ λ”© ν™κ²½μ—μ„ , ν¬μΈν„°κ°€ μ‚΄μ•„μμμ„ ν™•μΈν•κ³  μ“°λ ¤κ³  ν•λ” μκ°„μ—  
> λ‹¤λ¥Έλ°μ„ μ§€μ›λ²„λ¦¬λ” μƒν™©μ΄ λ°μƒν•  μ μμ.  
> κ·Έλ¬λ‹κΉ `expired()` λ” μ£½μ—λ”μ§€ ν™•μΈν•λ” μ©λ„λ΅λ§ μ“°κ³ ,  
> λ³΄ν†µμ€ `Lock()` μ„ κ±Έμ–΄μ£Όμ~

